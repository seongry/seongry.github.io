{"componentChunkName":"component---src-templates-blog-post-js","path":"/2021/06-20-common-mistakes-with-rty/","result":{"data":{"site":{"siteMetadata":{"title":"코알 데브 로그","author":"SeongRyeong Kim"}},"markdownRemark":{"id":"1ce16a19-d5bb-5a85-992e-f69287a17015","excerpt":"React Testing Library를 유용하게 잘 쓰고 있는 사람으로서, 공감도 가고 새로운 꿀팁도 많이 배웠던 좋은 글이라 번역해봤습니다. 원문: Common mistakes with React Testing Library 저는 사람들이 React Testing Library…","html":"<p>React Testing Library를 유용하게 잘 쓰고 있는 사람으로서, 공감도 가고 새로운 꿀팁도 많이 배웠던 좋은 글이라 번역해봤습니다.</p>\n<p>원문: <a href=\"https://kentcdodds.com/blog/common-mistakes-with-react-testing-library\">Common mistakes with React Testing Library</a></p>\n<hr>\n<p>저는 사람들이 React Testing Library로 만드는 실수를 자주 봅니다.</p>\n<p>안녕하세요 👋 저는 당시 테스트 환경에 만족하지 않아서 React Testing Library를 만들었습니다. 이것은 DOM Testing Library로 확장되었으며 이제 우리는 모든 인기 있는 자바스크립트 프레임워크 및 DOM을 대상으로 하는 테스팅 툴을(과 그렇지 않은 테스팅 툴을) 위한 Testing Library 구현체를 가졌습니다.</p>\n<p>시간이 지남에 따라, 저희는 API에 약간의 변경을 가했고, 최적이 아닌 패턴을 발견했습니다. 저희가 제공한 유틸리티를 사용하기 위한 “더 나은 방법”을 문서화하려는 노력에도, 여전히 최적이 아닌 패턴에 따라 작성된 블로그 포스팅이나 테스트를 보고 있으며, 이들 중 일부를 살펴보고 왜 좋지 않은지, 어떻게 이러한 함정을 피해서 테스트를 개선할 수 있는지 설명하고 싶습니다.</p>\n<blockquote>\n<p>Note: 저는 각 항목의 중요도에 따라 라벨을 매겼습니다.</p>\n<ul>\n<li>낮음: 이것은 보통 그냥 제 개인적 의견이며, 자유롭게 무시하셔도 괜찮습니다.</li>\n<li>중간: 버그를 경험하거나, 신뢰도를 잃거나, 필요치 않은 작업을 하게 될지도 모릅니다.</li>\n<li>높음: 꼭 이 조언을 들으세요! 신뢰도가 낮거나 문제가 있는 테스트가 있을 수 있습니다.</li>\n</ul>\n</blockquote>\n<h2>Tesing Library ESLint 플러그인을 사용하지 않기</h2>\n<blockquote>\n<p>중요도: medium</p>\n</blockquote>\n<p>만약 일반적인 실수들을 피하고 싶다면, 공식 ESLint 플러그인이 많은 도움이 될 것입니다:</p>\n<ul>\n<li><a href=\"https://github.com/testing-library/eslint-plugin-testing-library\">eslint-plugin-testing-library</a></li>\n<li><a href=\"https://github.com/testing-library/eslint-plugin-jest-dom\">eslint-plugin-jest-dom</a></li>\n</ul>\n<p><strong>조언: Testing Library에 ESLint 플러그인을 설치하고 사용하세요</strong></p>\n<h2><code class=\"language-text\">render</code>의 리턴 값에 대한 변수 이름으로 <code class=\"language-text\">wrapper</code>를 사용하기</h2>\n<blockquote>\n<p>중요도: 낮음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">const</span> wrapper <span class=\"token operator\">=</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example prop<span class=\"token operator\">=</span><span class=\"token string\">\"1\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nwrapper<span class=\"token punctuation\">.</span><span class=\"token function\">rerender</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example prop<span class=\"token operator\">=</span><span class=\"token string\">\"2\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> rerender <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example prop<span class=\"token operator\">=</span><span class=\"token string\">\"1\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">rerender</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example prop<span class=\"token operator\">=</span><span class=\"token string\">\"2\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">wrapper</code>라는 이름은 <code class=\"language-text\">enzyme</code>의 오래된 코드이며 여기선 필요하지 않습니다. <code class=\"language-text\">render</code>의 리턴 값은 아무것도 “감싸지(wrapping)” 않습니다. 이것은 (다음 항목 덕분에) 어쨌든 실제로 필요하지 않은 단순한 유틸리티의 조합 입니다.</p>\n<p><strong>조언: <code class=\"language-text\">render</code>로 부터 필요한 것을 구조 분해하거나, (wrapper 대신) <code class=\"language-text\">view</code>라고 부르세요</strong></p>\n<h2><code class=\"language-text\">cleanup</code>을 사용하기</h2>\n<blockquote>\n<p>중요도: 중간</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> render<span class=\"token punctuation\">,</span> screen<span class=\"token punctuation\">,</span> cleanup <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@testing-library/react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">afterEach</span><span class=\"token punctuation\">(</span>cleanup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> render<span class=\"token punctuation\">,</span> screen <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@testing-library/react\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>오랜 시간 동안 <code class=\"language-text\">cleanup</code>은 자동으로 이루어지고 (대부분 주요 테스팅 프레임워크에서 지원됨) 더는 거기에 대해 걱정할 필요가 없습니다. <a href=\"https://testing-library.com/docs/react-testing-library/api#cleanup\">더 알아보기</a></p>\n<p><strong>조언: <code class=\"language-text\">cleanup</code>을 사용하지 마세요</strong></p>\n<h2><code class=\"language-text\">screen</code> 사용하지 않기</h2>\n<blockquote>\n<p>중요도: 중간</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> getByRole <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> errorMessageNode <span class=\"token operator\">=</span> <span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alert\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> errorMessageNode <span class=\"token operator\">=</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alert\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">screen</code>은 <a href=\"https://github.com/testing-library/dom-testing-library/releases/tag/v6.11.0\">DOM Testing Library 6.11.0 버전에서 추가되었으며</a> (즉 <code class=\"language-text\">@testing-library/react@&gt;=9</code> 에 접근할 수 있어야 한다는 의미입니다.), <code class=\"language-text\">render</code>를 가져오는 곳과 동일한 import문에서 나옵니다:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> render<span class=\"token punctuation\">,</span> screen <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@testing-library/react\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">screen</code>을 사용해서 얻는 이점은 더는 필요한 쿼리를 추가/제거 할 때 <code class=\"language-text\">render</code>를 호출해 최신 상태로 구조 분해할 필요가 없다는 것입니다. 당신이 필요한 건 <code class=\"language-text\">screen</code>을 입력하는 것뿐입니다. 그리고 에디터의 자동완성 마법이 나머지를 처리합니다.</p>\n<p>이것의 유일한 예외는 이를 피해야 하는 <code class=\"language-text\">container</code>나 <code class=\"language-text\">baseElement</code>를 세팅한 경우입니다.(솔직히 이러한 옵션에 대한 합법적인 사용례를 더는 생각할 수 없었으며 현재로서는 역사적인 이유로만 존재합니다.)</p>\n<p><code class=\"language-text\">debug</code> 대신 <code class=\"language-text\">screen.debug</code>를 사용할 수도 있습니다.</p>\n<p><strong>조언: 쿼리와 디버깅을 위해 <code class=\"language-text\">screen</code>을 사용하세요</strong></p>\n<h2>잘못된 <a href=\"https://ko.wikipedia.org/wiki/%ED%91%9C%EB%AA%85\">단언문</a>을 사용하기</h2>\n<blockquote>\n<p>중요도: 높음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/disabled button/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ❌</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">.</span>disabled<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 에러 메세지:</span>\n<span class=\"token comment\">//  expect(received).toBe(expected) // Object.is equality</span>\n<span class=\"token comment\">//</span>\n<span class=\"token comment\">//  Expected: true</span>\n<span class=\"token comment\">//  Received: false</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeDisabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// 에러 메세지:</span>\n<span class=\"token comment\">//   Received element is not disabled:</span>\n<span class=\"token comment\">//     &lt;button /></span></code></pre></div>\n<p>위에서 사용한 <code class=\"language-text\">toBeDisabled</code> 단언문은 <code class=\"language-text\">jest-dom</code>에 있습니다. 훨씬 나은 에러 메세지를 받을 수 있으므로 <code class=\"language-text\">jest-dom</code>을 사용하는 것을 추천합니다.</p>\n<p><strong>조언: <a href=\"https://github.com/testing-library/jest-dom#tobedisabled\"><code class=\"language-text\">@testing-library/jest-dom</code></a>를 설치해서 사용하세요</strong></p>\n<h2><code class=\"language-text\">act</code>로 불필요하게 감싸기</h2>\n<blockquote>\n<p>중요도: 중간</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token function\">act</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"textbox\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/choose a fruit/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">act</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">keyDown</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> key<span class=\"token operator\">:</span> <span class=\"token string\">\"ArrowDown\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> input <span class=\"token operator\">=</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"textbox\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/choose a fruit/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nfireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">keyDown</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> key<span class=\"token operator\">:</span> <span class=\"token string\">\"ArrowDown\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>저는 사람들이 항상 “act” 경고문을 보고 필사적으로 경고문을 지우기 위해 이렇게 <code class=\"language-text\">act</code>로 감싸는 것을 봤습니다만, 그 사람들이 몰랐던 것은 <code class=\"language-text\">render</code>와 <code class=\"language-text\">fireEvent</code>는 항상 <code class=\"language-text\">act</code>로 감싸져 있다는 것입니다! 따라서 이런 행동은 유용하지 않습니다.</p>\n<p>대부분의 경우, <code class=\"language-text\">act</code> 경고문을 본다면, 무언가 그냥 침묵하는 것이 아니라 무언가 기대하지 않은 일이 당신의 테스트에서 일어나고 있다는 것을 말해주고 있는 것입니다. 제 블로그 포스팅(과 비디오)에서 여기에 대해 배울 수 있습니다.: <a href=\"https://kentcdodds.com/blog/fix-the-not-wrapped-in-act-warning\">“not wrapped in act(…)” 경고문 고치기.</a></p>\n<p><strong>조언: 언제 <code class=\"language-text\">act</code>가 필요한지 배우고 불필요하게 <code class=\"language-text\">act</code>로 감싸지 않기</strong></p>\n<h2>잘못된 쿼리를 사용하기</h2>\n<blockquote>\n<p>중요도: 높음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token comment\">// DOM이 동작한다고 가정하기:</span>\n<span class=\"token comment\">// &lt;label>Username&lt;/label>&lt;input data-testid=\"username\" /></span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByTestId</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"username\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token comment\">// 레이블을 연결하고 타입을 설정해 DOM을 접근가능하도록 변경</span>\n<span class=\"token comment\">// &lt;label for=\"username\">Username&lt;/label>&lt;input id=\"username\" type=\"text\" /></span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"textbox\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/username/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>저희는 <a href=\"https://testing-library.com/docs/guide-which-query\">“어떤 쿼리를 써야 하나요?”</a>라는 쿼리들의 사용 우선순위 페이지를 운영하고 있습니다. 혹시 당신의 목표가 사용자가 당신의 앱을 사용할 때 작동할 것이라는 확신을 주는 테스트라는 저희의 목적과 일치한다면, 가능한 최종 사용자가 하는 방식에 가깝게 DOM을 쿼리하는 것이 좋습니다. 저희가 제공하는 쿼리들은 이를 도와드립니다만, 모든 쿼리들이 동일하게 생성되진 않습니다.</p>\n<h3><code class=\"language-text\">container</code>를 사용하여 요소 쿼리</h3>\n<p>“잘못된 쿼리를 사용하기”의 하위 섹션으로 <code class=\"language-text\">container</code>에서 직접 쿼리하는 것에 대해 이야기해 보고 싶습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> container <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> button <span class=\"token operator\">=</span> container<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".btn-primary\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>button<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveTextContent</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/click me/i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>Example <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/click me/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>유저들이 UI와 상호작용할 수 있는데 <code class=\"language-text\">querySelector</code>를 사용해서 쿼리하면 많은 신뢰도를 잃고, 테스트가 읽기 힘들어지며, 테스트가 더 자주 중단될 것이라고 확신합니다. 다음 하위 섹션에서 이어서 진행됩니다.</p>\n<h3>텍스트로 쿼리하지 않음</h3>\n<p>“잘못된 쿼리를 사용하기”의 하위 섹션으로, 왜 제가 테스트 ID나 그 외 기술적인 것들을 사용하는 대신 <em>실제</em> 텍스트(localization을 예로 들면, 저는 기본 locale을 추천합니다.)로 쿼리하는 것을 추천하는지에 대해 이야기하고 싶습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByTestId</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"submit-button\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/submit/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>실제 텍스트로 쿼리하지 않으면, 번역이 올바르게 적용되는지 확인하기 위해 추가 작업을 해야 합니다. 이것에 관련된 제가 듣는 가장 큰 불만은 컨텐츠 작성자가 테스트를 망가뜨리게 한다는 것입니다. 이에 대한 반박으로 먼저, 만약 컨텐츠 작성자가 “유저이름”을 “이메일”로 바꾸는 경우, 그것은 제가 명백히 알아야 하는 변경 점이라는 것입니다.(제 구현체를 바꿔야 하니까요) 또, 뭔가 망가지는 상황이 있더라도 분류하고 문제를 고치는 게 쉬워서 해당 문제를 고치는데 전혀 시간이 걸리지 않습니다.</p>\n<p>따라서 비용은 매우 낮은데, 번역이 올바르게 적용되고 테스트를 읽고 쓰기 더 쉬워진다는 확신을 얻을 수 있다는 이득이 있습니다.</p>\n<p>모든 사람이 제게 동의하지 않을 수 있다고 말씀드렸습니다, 이것에 자세히 알고 싶다면 <a href=\"https://twitter.com/kentcdodds/status/1203179007644012544\">이 트위터 스레드</a>를 읽어보세요.</p>\n<h3><code class=\"language-text\">*ByRole</code>를 대부분 사용하지 않기</h3>\n<p>“잘못된 쿼리를 사용하기”의 하위 섹션으로, <code class=\"language-text\">*ByRole</code>에 대해 이야기 하고 싶습니다. 최근 버전에서는, <code class=\"language-text\">*ByRole</code> 쿼리는 많은 개선이 있었고(멋진 작업을 해주신 <a href=\"https://twitter.com/sebsilbermann\">Sebastian Silbermann</a> 감사합니다) 이제 컴포넌트 출력물을 쿼리하는데 가장 권장되는 접근 방식입니다. 제가 좋아하는 기능들 몇 개를 보시죠.</p>\n<p><code class=\"language-text\">name</code> 옵션을 사용하면 엘리먼트에 대해 스크린 리더(screen reader)에서 읽을 <a href=\"https://www.w3.org/TR/accname-1.1/\">접근가능한 이름(Accessible Name)</a>으로 엘리먼트를 쿼리할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// DOM이 동작한다고 가정하기</span>\n<span class=\"token comment\">// &lt;button>&lt;span>Hello&lt;/span> &lt;span>World&lt;/span>&lt;/button></span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByText</span><span class=\"token punctuation\">(</span><span class=\"token regex\">/hello world/i</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ❌ 아래와 같은 에러와 함께 실패함:</span>\n<span class=\"token comment\">// 다음과 같은 텍스트를 가진 엘리먼트를 찾을 수 없습니다: /hello world/i.</span>\n<span class=\"token comment\">// 이것은 다수의 엘리먼트들에 의해 텍스트가 부서졌기 때문일 수 있습니다.</span>\n<span class=\"token comment\">// 이런 경우, 텍스트 matcher를 더 유연하게 만들기 위해 함수를 제공할 수 있습니다.</span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/hello world/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅ 동작함!</span></code></pre></div>\n<p>사람들이 <code class=\"language-text\">*ByRole</code> 쿼리를 사용하지 않는 이유는 엘리먼트에 배치된 암시적인 역할에 익숙하지 않기 때문입니다. <a href=\"https://developer.mozilla.org/en-US/docs/Web/Accessibility/ARIA/Roles\">여기 MDN의 규칙 리스트가 있습니다</a>. 그래서 <code class=\"language-text\">*ByRole</code> 쿼리의 제가 좋아하는 기능의 또 다른 점은 지정한 역할을 가진 엘리먼트를 찾을 수 없는 경우, 일반적인 <code class=\"language-text\">get*</code>이나 <code class=\"language-text\">find*</code> 변형과 마찬가지로 전체 DOM의 로그를 남길 뿐 아니라 쿼리 할 수 있는 모든 사용 가능한 역할들도 로그를 남깁니다!</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// 작동하는 DOM 구조가 있다고 가정</span>\n<span class=\"token comment\">// &lt;button>&lt;span>Hello&lt;/span> &lt;span>World&lt;/span>&lt;/button></span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"blah\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이것은 아래 에러 메세지와 함께 실패할 것입니다:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">TestingLibraryElementError<span class=\"token operator\">:</span> <span class=\"token string\">\"blah\"</span> 규칙을 가진 접근가능한 엘리먼트를 찾을 수 없었습니다<span class=\"token punctuation\">.</span>\n접근가능한 규칙은 아래와 같습니다<span class=\"token operator\">:</span>\n  button<span class=\"token operator\">:</span>\n  Name <span class=\"token string\">\"Hello World\"</span><span class=\"token operator\">:</span>\n  <span class=\"token operator\">&lt;</span>button <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span><span class=\"token operator\">--</span>\n<span class=\"token operator\">&lt;</span>body<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>button<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>\n        Hello\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>span<span class=\"token operator\">></span>\n        World\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>span<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>body<span class=\"token operator\">></span></code></pre></div>\n<p>버튼 역할을 가지려고 버튼에 <code class=\"language-text\">role=button</code> 를 추가할 필요가 없었다는 것에 주의하세요. 이건 우리를 다음 조언으로 완벽하게 이어지게 하는 암묵적인 역할을 합니다.</p>\n<p><strong>조언: <a href=\"%5Bhttps://testing-library.com/docs/guide-which-query%5D(https://testing-library.com/docs/guide-which-query)\">“어떤 쿼리를 써야할까요” 가이드</a>를 읽고 추천을 따르세요.</strong></p>\n<h2><code class=\"language-text\">aria-</code>, <code class=\"language-text\">role</code> 및 기타 접근성 속성(accessibility attributes)을 잘못 추가하기</h2>\n<blockquote>\n<p>중요도: 높음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>button role<span class=\"token operator\">=</span><span class=\"token string\">\"button\"</span><span class=\"token operator\">></span>Click me<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// ✅</span>\n<span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>button<span class=\"token operator\">></span>Click me<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>button<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>손쉬운 접근성 속성은 좋든 싫든 불필요할 뿐 아니라(앞에서 본 사례처럼), 스크린 리더와 서비스 이용자들을 혼란스럽게 만듭니다. 접근성 속성은 정말 의미론적 HTML이 use case를 만족시키지 못할 때만 필요합니다.(<a href=\"%5Bhttps://github.com/downshift-js/downshift%5D(https://github.com/downshift-js/downshift)\">downshift의 autocomplete 처럼</a> 접근성이 향상된 비 네이티브 UI를 만들고 싶을 때 처럼요) 혹시 이게 당신이 만들던 거라면, 접근성을 향상시키는 기존의 라이브러리를 이용하거나 WAI-ARIA practices를 따르세요. 거기엔 <a href=\"%5Bhttps://www.w3.org/TR/wai-aria-practices/examples/accordion/accordion.html%5D(https://www.w3.org/TR/wai-aria-practices/examples/accordion/accordion.html)\">좋은 예시들</a>이 있습니다.</p>\n<blockquote>\n<p>Note: “role”을 통해 <code class=\"language-text\">input</code> 에 접근성을 향상시키기 위해선 <code class=\"language-text\">type</code> 속성을 지정해야 합니다!</p>\n</blockquote>\n<p><strong>조언: 불필요하거나 잘못된 접근성 속성 추가를 피하세요</strong></p>\n<h2><code class=\"language-text\">@testing-library/user-event</code> 사용하지 않기</h2>\n<blockquote>\n<p>중요도: 중간</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\nfireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">change</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> target<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> value<span class=\"token operator\">:</span> <span class=\"token string\">\"hello world\"</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\nuserEvent<span class=\"token punctuation\">.</span><span class=\"token function\">type</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"%5Bhttps://github.com/testing-library/user-event%5D(https://github.com/testing-library/user-event)\"><code class=\"language-text\">@testing-library/user-event</code></a>는 <code class=\"language-text\">fireEvent</code> 의 기반으로 빌드된 패키지지만, 사용자 상호작용과 더 유사한 여러 메서드들을 제공합니다. 앞의 예제에서, <code class=\"language-text\">fireEvent.change</code> 는 단순히 input의 하나의 변경 이벤트를 트리거할 것입니다. 하지만 <code class=\"language-text\">type</code> 호출은 문자마다 <code class=\"language-text\">keyDown</code>, <code class=\"language-text\">keyPress</code>, <code class=\"language-text\">keyUp</code> 이벤트들을 트리거합니다. 이쪽이 훨씬 실제 사용자 상호작용과 유사하죠. 이것은 변경 이벤트를 수신하지 않는 라이브러리와도 잘 동작한다는 이점이 있습니다.</p>\n<p>저희는 계속 <code class=\"language-text\">@testing-library/user-event</code> 가 약속한 것을 가져다주는지 확인하고 있습니다: 특정 작업을 수행할 때 유저가 실행할 모든 동일한 이벤트를 실행합니다. 저는 저희가 아직 거기에 도달했다고 생각하지는 않기 때문에 <code class=\"language-text\">@testing-library/dom</code> 에 포함되지 않았습니다.(언젠가 미래엔 될지도 모르지만요) 하지만 <code class=\"language-text\">fireEvent</code> 보다 <code class=\"language-text\">@testing-library/user-event</code>의 유틸리티를 사용하는 것을 강력히 추천합니다.</p>\n<p><strong>조언: 가능한 <code class=\"language-text\">fireEvent</code> 보다 <code class=\"language-text\">@testing-library/user-event</code> 를 사용하세요</strong></p>\n<h2>존재 여부를 확인하는 경우 외의 모든 곳에 <code class=\"language-text\">query*</code> 변형을 사용하기</h2>\n<blockquote>\n<p>중요도: 높음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">queryByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alert\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeInTheDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alert\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeInTheDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">queryByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alert\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBeInTheDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>쿼리들의 <code class=\"language-text\">query*</code> 변형이 노출되는 <em>유일한</em> 이유는 쿼리와 일치하는 엘리먼트가 없을 때 에러를 발생하지 않고 호출할 수 있는 함수를 갖기 때문입니다.(아무 요소도 찾을 수 없으면 <code class=\"language-text\">null</code>을 반환합니다.) 이것이 유용한 유일한 이유는 엘리먼트가 페이지에 렌더링 되지 않았는지 확인하는 것입니다.</p>\n<p><strong>조언: <code class=\"language-text\">query*</code> 변형은 엘리먼트를 찾을 수 없다는 단언을 할 때만 사용하세요</strong></p>\n<h2><code class=\"language-text\">find*</code> 로 쿼리할 수 있는 엘리먼트를 <code class=\"language-text\">waitFor</code> 를 사용해서 기다리기</h2>\n<blockquote>\n<p>중요도: 높음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">const</span> submitButton <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">waitFor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/submit/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token keyword\">const</span> submitButton <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">findByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"button\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/submit/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>저 두 줄의 코드는 근본적으로 같지만(<code class=\"language-text\">find*</code> 쿼리는 내부에서 <code class=\"language-text\">waitFor</code>을 사용합니다), 두 번째 코드가 더 간단하고 더 나은 에러메세지를 받을 수 있습니다.</p>\n<p><strong>조언: 즉시 사용할 수 없는 무언가를 쿼리하고 싶을 때는 언제든지 <code class=\"language-text\">find*</code>을 사용하세요</strong></p>\n<h2><code class=\"language-text\">waitFor</code> 에 빈 콜백을 넘겨주기</h2>\n<blockquote>\n<p>중요도: 높음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">await</span> <span class=\"token function\">waitFor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token keyword\">await</span> <span class=\"token function\">waitFor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">waitFor</code> 의 목적은 특정한 것이 일어날 때까지 기다리게 하는 것입니다. 만약 빈 콜백을 넘겨준다면 모의 작업의 방식 덕분에 “이벤트 루프의 한 틱(tick)“만 기다리면 되기 때문에 오늘은 동작<em>할지도 모릅니다.</em> 하지만 비동기 로직을 리펙터링하면 쉽게 실패하는 취약한 테스트가 남게 됩니다.</p>\n<p><strong>조언: <code class=\"language-text\">waitFor</code> 내부의 명확한 단언문을 기다립니다</strong></p>\n<h2>단일 <code class=\"language-text\">waitFor</code> 콜백 안의 다중 단언문을 가지기</h2>\n<blockquote>\n<p>중요도: 낮음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">await</span> <span class=\"token function\">waitFor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token keyword\">await</span> <span class=\"token function\">waitFor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledWith</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"foo\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>fetch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalledTimes</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>앞의 예시에서 <code class=\"language-text\">window.fetch</code>가 두 번 호출된다고 가정해봅시다. 따라서 <code class=\"language-text\">waitFor</code> 호출은 실패하지만, 우리는 테스트 실패를 보기 전에 타임아웃을 기다려야 합니다. waitFor 안에 단일 단언문만 넣음으로써, 우리는 UI가 우리가 기대했던 대로 단언한 상태가 될 때까지 기다리거나, 단언문들 중 하나가 실패하면 더 빨리 실패를 볼 수 있습니다.</p>\n<p><strong>조언: 콜백안에는 하나의 단언문만 넣으세요</strong></p>\n<h2><code class=\"language-text\">waitFor</code>에 사이드 이펙트 수행하기</h2>\n<blockquote>\n<p>중요도: 높음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\n<span class=\"token keyword\">await</span> <span class=\"token function\">waitFor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  fireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">keyDown</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> key<span class=\"token operator\">:</span> <span class=\"token string\">\"ArrowDown\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">getAllByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"listitem\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\nfireEvent<span class=\"token punctuation\">.</span><span class=\"token function\">keyDown</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> key<span class=\"token operator\">:</span> <span class=\"token string\">\"ArrowDown\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">await</span> <span class=\"token function\">waitFor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">getAllByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"listitem\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveLength</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">waitFor</code>은 수행한 작업과 단언문 전달 사이에 비결정적 시간이 있는 테스트를 위한 것입니다. 이러한 이유로, 콜백은 비결정적 횟수와 빈도로 호출될(혹은 에러 검사할) 수 있습니다.(DOM이 변경될 때 마다도 호출됩니다). 따라서 이것은 사이드 이펙트가 여러 번 실행될 수 있다는 뜻입니다!</p>\n<p>또한 이건 <code class=\"language-text\">waitFor</code> 내부에 스냅샷 단언문을 사용할 수 없다는 의미이기도 합니다. 만약 스냅샷 단언문을 사용하고 싶다면, 우선 특정 단언문을 기다리고, 그다음 스냅샷을 찍으면 됩니다.</p>\n<p><strong>조언: <code class=\"language-text\">waitFor</code> 콜백 바깥에 사이드 이펙트를 넣고 콜백 안에는 단언문만 사용하세요</strong></p>\n<h2><code class=\"language-text\">get*</code> 변형을 단언문처럼 사용하기</h2>\n<blockquote>\n<p>중요도: 낮음</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// ❌</span>\nscreen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alert\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/error/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ✅</span>\n<span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByRole</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"alert\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token regex\">/error/i</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeInTheDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이건 그리 큰 문제는 아니지만, 문제에 대해 언급하고 제 의견을 드려야 할 것 같습니다. 만약 <code class=\"language-text\">get*</code> 쿼리들이 엘리먼트를 찾는 데 실패했다면, 쿼리들은 디버깅에 도움이 될 수 있도록 전체 DOM 구조를(문법에 하이라이팅까지 해서) 보여주는 아주 유용한 에러 메세지를 던질 겁니다. 이것 때문에, 단언문은 절대로 실패할 가능성이 없습니다.(왜냐면 쿼리들이 단언문이 실행되기 전에 에러를 던질 테니까요).</p>\n<p>이러한 이유에서, 많은 사람들은 단언문을 건너뜁니다. 솔직히 이래도 정말 괜찮아요, 다만 저는 개인적으로 보통 코드를 읽는 사람에게 이것이 리펙터링 이후에 붙어있는 오래된 쿼리가 아니라 그것이 존재함을 명확하게 알려주기 위해 단언문을 유지합니다.</p>\n<p><strong>조언: 뭔가 존재함을 단언하고 싶으면, 단언문을 명시적으로 만드세요</strong></p>\n<h2>결론</h2>\n<p>테스트 라이브러리 도구 제품군의 메인테이너로서, 가능한 효과적으로 사용할 수 있는 API를 만들기 위해 최선을 다하고 부족한 부분은 올바르게 문서화하려고 노력하고 있습니다. 다만 이는 매우 어려울 수 있습니다(특히 API의 변경,개선 등). 이 문서가 도움되었길 바랍니다. 저희는 당신이 자신감을 가지고 소프트웨어를 더 성공적으로 전달할 수 있길 바랍니다.</p>\n<p>행운을 빕니다!</p>","frontmatter":{"title":"Common mistakes with React Testing Library","date":"June 20, 2021","tags":["react","react-testing-library","번역"]}}},"pageContext":{"slug":"/2021/06-20-common-mistakes-with-rty/","previous":{"fields":{"slug":"/2021/04-24-heap-01/"},"frontmatter":{"title":"[자료구조] Heap 01"}},"next":{"fields":{"slug":"/2021/07-01-use-console-log-like-a-pro/"},"frontmatter":{"title":"Use console.log() like a pro"}}}}}